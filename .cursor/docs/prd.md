### 1. **체크리스트 항목과 PRD 반영 여부 검토**

#### 1.1. **체크리스트 항목 분석**
체크리스트는 비인증 네트워크 점검의 단계별 작업을 정의하며, 각 단계는 점검 분류, 구체적인 액션, 예상 결과, 비고로 구성되어 있습니다. 이를 PRD의 **Processing** 및 **Output** 섹션과 대조하여 반영 여부를 확인합니다.

- **단계 1: 호스트 탐색**
  - **1.1 로컬 네트워크 내 활성 IP 식별**:
    - 액션: ARP (-PR), ICMP (-PE), 응답 없을 시 -Pn 조건부 사용.
    - 예상 결과: Alive IP 목록.
    - 비고: -PR 권장, -Pn은 트래픽 증가 유발 가능.
- **단계 2: 포트/서비스 스캔**
  - **2.1 주요 TCP 포트 스캔**:
    - 액션: Top 100/커스텀 포트 스캔.
    - 예상 결과: 열린 포트 목록.
    - 비고: `--top-ports 100 -T1`.
  - **2.2 서비스 버전/배너 수집**:
    - 액션: -sV --version-intensity 2 -T1.
    - 예상 결과: 포트별 버전 정보.
- **단계 3: OS 추정**
  - **3.1 OS Fingerprint**:
    - 액션: -O -T1 (※ -f 제거).
    - 예상 결과: OS 및 버전 추정.
- **단계 4: 세부 점검**
  - **4.1 SMB 기본 정보 수집**: `--script smb-protocols, smb-os-discovery`.
  - **4.2 공유 폴더 익명 접근**: `--script smb-enum-shares`.
  - **4.3 HTTP 서비스 확인**: `--script http-server-header, http-fetch`.
  - **4.4 HTTPS 서비스 확인**: 동일.
  - **4.5 SSL/TLS 취약 프로토콜, Cipher 확인**: `--script ssl-enum-ciphers`.
  - **4.6 FTP 익명 로그인 허용 여부**: `--script ftp-anon`.
  - **4.7 Telnet 서비스 여부**: 사용 금지 권고.
  - **4.8 RDP 서비스 여부**: 3389/tcp 확인.
  - **4.9 VNC 서비스 여부**: 5900-5902/tcp 확인.
  - **4.10 SNMP 기본 커뮤니티 문자열 확인**: `-sU --script snmp-info`, UDP 신뢰도 주의.
  - **4.11 DNS/mDNS (53/udp), 4.12 DHCP (67/68/udp)**: 선택적 수행, UDP 스캔 시간 소요 큼.
- **단계 5: 점검 분석 (오프라인)**
  - **5.1 OS 기반 EOS 여부 확인**: 오프라인 매핑 (예: Win7).
  - **5.2 버전 기반 취약점(CVE) 확인**: 오프라인 CVE 매핑.
  - **5.3 취약 프로토콜 사용 여부**: SMBv1, Telnet 등.
  - **5.4 배너 민감 정보 확인**: -sV로 충분하면 `--script banner` 생략.

#### 1.2. **PRD v1.2와의 대조**
PRD의 **Processing** 및 **Output** 섹션에서 체크리스트 항목이 반영되었는지 확인합니다.

- **Processing**:
  - **체크리스트 기반 순차적 또는 병렬 점검**: PRD에서 "정의된 체크리스트(점검 항목) 기반 순차적 또는 병렬(IP 단위) 점검 흐름 자동화"로 반영됨.
  - **Nmap CLI 호출**: PRD에서 `subprocess`로 Nmap 실행 및 결과 파싱 명시.
  - **NSE 스크립트 최소화**: PRD에서 "NSE 스크립트는 명시된 최소한의 안전한 스크립트만 사용"으로 반영됨.
  - **구체적 점검 항목**:
    - 호스트 탐색(1.1): PRD에서 구체적 액션(-PR, -PE, -Pn) 미명시.
    - 포트/서비스 스캔(2.1, 2.2): PRD에서 포함, 하지만 `--version-intensity 2` 미명시.
    - OS 추정(3.1): PRD에서 포함, -O -T1 명시 필요.
    - 세부 점검(4.1~4.12): PRD에서 일부(SMB, HTTP, HTTPS)만 포함, 나머지(FTP, Telnet, RDP, VNC, SNMP, DNS/mDNS, DHCP) 미명시.
  - **보안 솔루션 탐지 대응**: PRD에서 반영됨.
  - **상태 저장 및 Resume**: PRD에서 반영됨.
- **Output**:
  - **리포트**: PRD에서 `.xlsx` 형식으로 IP, 호스트 상태, OS 추정, 열린 포트, 서비스/버전, 점검 항목 결과(SMBv1, 익명 공유, 취약 TLS), 차단 여부 포함.
    - 체크리스트의 예상 결과(Alive IP, 열린 포트, 버전 정보, OS 추정, SMB 정보, 취약 프로토콜 등) 대부분 반영됨.
    - 누락: MAC 주소(ARP 스캔 시), 정책 위반 여부, 배너 민감 정보.
  - **로그**: PRD에서 `.log`, `.json`으로 모든 단계 기록, 차단 내역 별도 기록 반영됨.

#### 1.3. **누락 및 개선 필요 항목**
- **Processing**:
  - 호스트 탐색: -PR, -PE, -Pn 조건부 사용 명시 필요.
  - 포트/서비스 스캔: `--version-intensity 2` 추가.
  - OS 추정: -O -T1 명시.
  - 세부 점검: FTP, Telnet, RDP, VNC, SNMP, DNS/mDNS, DHCP 점검 항목 추가.
  - NSE 스크립트: 구체적 스크립트 목록(smb-protocols, http-server-header 등) 명시.
- **Output**:
  - 리포트: MAC 주소, 정책 위반 여부, 배너 민감 정보 추가.
  - CVE 매핑: 오프라인 CVE DB 매핑 방법 구체화.
- **Input**:
  - `port_list` 외에 UDP 스캔 관련 설정(`udp_scan`)은 반영됨, 하지만 선택적 점검(DNS/mDNS, DHCP) 설정 추가 필요.

---

### 2. **최종 업데이트된 PRD (v1.3)**

#### 📘 통합 Product Requirements Document (PRD) - 상업용 비인증 네트워크 점검 시스템 (v1.3 - 최종 업데이트)

---

##### 🧩 프로젝트 개요
이 프로젝트는 소규모 기업, 보안 컨설팅 업체, 개인 보안 전문가를 타겟으로 하며, 폐쇄망/내부망 환경에서 동작하는 **비인증 기반 저강도 네트워크 점검 솔루션**입니다. 이 제품은 **상업용**으로 설계되며, 다양한 운영 환경(지정 PC, USB 휴대형, 폐쇄망 상주형 등)에 대응하고, **XDR/백신 등 보안 솔루션 탐지를 우회**하면서도 장애 없이 작동해야 합니다. 모든 기능은 **Cursor AI**를 통해 자동화된 모듈 단위로 개발 및 유지보수되며, **코딩 초보자도 사용 및 관리가 쉬운 구조**를 목표로 합니다. 경쟁 제품(Nmap 기본 사용, Nessus Essentials, OpenVAS 등) 대비 간단한 UI, 초보자 친화적 설계, 저렴한 가격($99 일회성 + $49 연간 지원료)으로 차별화됩니다.

- **예상 개발 기간**: 8주 (기능 구현 중심).
- **초기 투자 비용 (추정)**: $1,000 (개발자 시간 비용 및 필요 리소스 기준).
- **성공 지표 (목표)**: 초기 6개월 내 월 판매량 10개 이상 달성, 고객 만족도 90% 이상 유지.

---

##### 🎯 핵심 목표
- 비인증, 저강도, 저부하 기반 진단 시스템 구축.
- 보안 솔루션(XDR, IPS, 백신 등)에 대한 탐지 가능성 최소화 및 탐지 시 회피(SKIP) 로직 구현.
- 네트워크, PC, 서비스에 대한 부하 최소화 (목표: CPU < 5%, RAM < 5%, 네트워크 트래픽 < 1Mbps).
- 라이선스 키 기반 실행 및 기능 통제 (로그인 없이 오프라인 인증 가능).
- 스캔 중단/장애 발생 시 진행 상태 저장 및 이어하기(Resume) 기능 지원.
- 정교하고 세련된 상업용 UI 디자인 (직관성, 사용 편의성 중점, 최소 클릭으로 작동).
- 각 단계별 진행률을 컬러풀한 Progress Bar로 표시, ETA(예상 종료 시간) 제공.
- 안정적인 오류 처리: 예상치 못한 오류(Nmap 오류, 설정 파일 오류, 권한 부족 등) 발생 시 사용자에게 명확히 알리고 로그 기록.

---

##### 🔐 상업용 기능 및 보안 정책
- **라이선스 키 기반 등록 및 실행 제어** (로그인 기능 생략).
  - 라이선스 키는 서버 없이 오프라인으로 유효성 검사 (SHA-256 해시 기반 검증).
  - 키 형식: `CUSTOMER-ID-YYYYMMDD` (예: `COMPANYA-20250411`).
  - 키 검증 로직: 키를 해시하여 저장된 해시값과 비교, 유효 기간(YYYYMMDD) 확인.
- **프로그램 삭제 또는 재설치 시에도 라이선스 키 지속 확인**:
  - Windows: 레지스트리(HKLM\Software\NetworkScanner)에 키 정보 저장.
  - Linux: 홈 디렉토리 내 숨김 파일(예: `~/.networkscanner/license`)에 저장.
- **보안 솔루션 탐지 시 해당 단계 자동 SKIP**:
  - 탐지 기준: Nmap 실행 중 "connection reset", "access denied", "blocked by firewall" 등의 오류 발생 시.
  - 탐지 시 해당 IP/포트에 대한 후속 점검 SKIP 및 상태 기록.
- **탐지/차단된 IP 및 포트 정보를 리포트 및 로그에 명확히 기록**.
- **모든 점검 시작/종료/오류/재시작 이력을 상세 로그(JSON 및 Log 파일)로 저장**.
- **재시작 시 이전 중단 위치부터 자동 복구 수행** (상태 저장 파일 활용).
- **스텔스 기능 (최소화된 탐지 노력)**:
  - 실행 프로세스 이름 예측 불가능성 증대 (예: 실행 시마다 무작위 이름 생성, `svc_{random_string}.exe`).
  - Task Manager에서 쉽게 식별되지 않도록 아이콘/설명 최소화 (단, 완벽한 숨김은 EDR 탐지 가능성 높아 제외).
- **USB 기반 휴대 가능**:
  - 실행 파일 및 필요 파일(`config.ini`, 결과 폴더) 포함.
  - 자동 실행(Autorun) 방지 설정 (`autorun.inf` 파일 생성 방지).
- **장비 ID 기반 통제 제거**: 라이선스 키 자체로만 통제, 복잡성 감소.

---

##### ⚙️ 시스템 구성 (UIPO 모듈 구조)

###### UI (PyQt 기반 데스크톱 UI)
- **PyQt5/PySide6 기반 데스크톱 GUI 애플리케이션**.
- **반응형 레이아웃**:
  - 창 크기 변경 시 위젯 크기 및 배치가 동적으로 자연스럽게 조절됨 (QVBoxLayout, QHBoxLayout, QGridLayout 필수 사용).
- **상태 표시**:
  - 컬러 기반 상태 표시 (초록: 성공, 노랑: 진행, 회색: 대기/SKIP, 빨강: 오류).
- **진행 상황**:
  - 전체 진행률(QProgressBar), 현재 작업 단계 및 대상 IP 표시, ETA(예상 종료 시간) 표시.
  - ETA 계산: 평균 스캔 시간(초/IP) × 남은 IP 수로 추정.
- **설정 편집**:
  - `config.ini` 파일 내용을 로드하여 GUI 상에서 쉽게 편집하고 저장하는 기능 (QLineEdit, QComboBox 활용).
  - 예: 네트워크 대역 입력 필드, 스캔 속도 드롭다운.
- **결과 조회/관리**:
  - 최근 점검 결과 요약 테이블(QTableWidget) 표시.
  - 상세 결과 조회 기능 (더블클릭 시 상세 로그 표시).
  - 리포트(Excel) 다운로드 버튼(QPushButton).

###### Input
- **`config.ini` 파일 기반 설정**:
  - `network`: 점검 대상 네트워크 대역 (CIDR 형식, 쉼표로 다중 입력 가능, 기본값: "192.168.1.0/24").
  - `allowed_days`: 점검 허용 요일 (기본값: "Mon,Tue,Wed,Thu,Fri,Sat,Sun").
  - `allowed_hours`: 점검 허용 시간 (기본값: "00:00-23:59").
  - `scan_speed`: Nmap 타이밍 템플릿 (기본값: "T1").
  - `udp_scan`: UDP 스캔 수행 여부 (기본값: false).
  - `port_list`: 스캔할 포트 목록 (기본값: "--top-ports 100").
  - `optional_checks`: 선택적 점검 항목 (DNS/mDNS, DHCP 등, 기본값: "none").
- **라이선스 키**:
  - 프로그램 실행 시 또는 초기 설정 시 입력받아 유효성 검증 (QInputDialog 활용).
- **스케줄 실행 (선택적 기능)**:
  - 설정된 요일/시간에 자동으로 스캔 시작 (Python `schedule` 라이브러리 또는 OS 작업 스케줄러 연동).

###### Processing
- **정의된 체크리스트(점검 항목) 기반 순차적 또는 병렬(IP 단위) 점검 흐름 자동화**:
  - **단계 1: 호스트 탐색**:
    - 1.1 로컬 네트워크 내 활성 IP 식별: ARP (-PR) 기본, ICMP (-PE) 보조, 응답 없을 시 -Pn 조건부 사용 (트래픽 증가 주의).
  - **단계 2: 포트/서비스 스캔**:
    - 2.1 주요 TCP 포트 스캔: `--top-ports 100 -T1` (또는 사용자 지정 포트).
    - 2.2 서비스 버전/배너 수집: `-sV --version-intensity 2 -T1`.
  - **단계 3: OS 추정**:
    - 3.1 OS Fingerprint: `-O -T1`.
  - **단계 4: 세부 점검**:
    - 4.1 SMB 기본 정보 수집: `--script smb-protocols, smb-os-discovery`.
    - 4.2 공유 폴더 익명 접근: `--script smb-enum-shares`.
    - 4.3 HTTP 서비스 확인: `--script http-server-header, http-fetch`.
    - 4.4 HTTPS 서비스 확인: 동일.
    - 4.5 SSL/TLS 취약 프로토콜, Cipher 확인: `--script ssl-enum-ciphers`.
    - 4.6 FTP 익명 로그인 허용 여부: `--script ftp-anon`.
    - 4.7 Telnet 서비스 여부: Telnet 포트(23/tcp) 확인, 사용 금지 권고.
    - 4.8 RDP 서비스 여부: 3389/tcp 확인.
    - 4.9 VNC 서비스 여부: 5900-5902/tcp 확인.
    - 4.10 SNMP 기본 커뮤니티 문자열 확인: `-sU --script snmp-info` (UDP 신뢰도 주의).
    - 4.11 DNS/mDNS (53/udp), 4.12 DHCP (67/68/udp): 선택적 수행, UDP 스캔 시간 소요 큼.
  - **단계 5: 점검 분석 (오프라인)**:
    - 5.1 OS 기반 EOS 여부 확인: 오프라인 매핑 (예: Windows 7 → EOS 2020-01-14).
    - 5.2 버전 기반 취약점(CVE) 확인: 오프라인 CVE DB 매핑 (예: Apache 2.4.49 → CVE-2021-41773).
    - 5.3 취약 프로토콜 사용 여부: SMBv1, Telnet 등 확인, 정책 위반 여부 포함.
    - 5.4 배너 민감 정보 확인: -sV 결과 활용, `--script banner` 생략.
- **Nmap CLI 호출**:
  - `subprocess` 모듈을 사용하여 Nmap 명령어 실행 및 결과 파싱 (표준 출력/오류, XML 출력 활용).
  - NSE 스크립트는 명시된 최소한의 안전한 스크립트만 사용 (예: `smb-protocols`, `http-server-header`).
- **보안 솔루션 탐지 대응**:
  - Nmap 실행 결과(오류 코드, 메시지)를 분석하여 탐지/차단으로 판단되면 해당 IP/포트에 대한 후속 점검 SKIP 및 상태 기록.
- **상태 저장 및 Resume**:
  - 스캔 중단(사용자 요청, 오류, PC 종료 등) 시 현재 진행 상태(마지막 점검 IP, 완료된 IP 목록 등)를 파일(`scan_state.json`)에 저장.
  - 재시작 시 이 파일을 읽어 중단된 지점부터 스캔 재개.
- **오류 처리 및 로깅**:
  - 모든 주요 작업 단계, 오류 발생, 사용자 액션 등을 상세히 로그 파일에 기록.

###### Output
- **주요 리포트**: `.xlsx` (Excel) 형식, 가독성 및 고객 친화성 고려.
  - 포함 내용:
    - IP 주소, MAC 주소 (ARP 스캔 시), 호스트 상태, OS 추정 결과, 열린 포트 목록, 포트별 서비스/버전.
    - 점검 항목 결과: SMBv1 여부, 익명 공유, 취약 TLS, FTP 익명 로그인, Telnet/RDP/VNC/SNMP/DNS/DHCP 서비스 여부.
    - 보안 솔루션 차단 여부 및 포트, 점검 시간.
    - 오프라인 분석: EOS 여부, 잠재적 취약점(CVE), 취약 프로토콜(SMBv1, Telnet 등), 정책 위반 여부, 배너 민감 정보(OS, 내부 IP 등).
  - 결과 요약 (대시보드 형태 시트) 및 상세 결과 시트 분리.
- **로그 파일**:
  - `.log`: 텍스트 기반 상세 실행 로그 (디버깅 및 추적용).
  - `.json`: 구조화된 로그 (예: `{"timestamp": "2025-04-11T10:00:00", "step": "Host Discovery", "ip": "192.168.1.10", "status": "success", "error": null}`).
- **차단 내역**:
  - 보안 솔루션 등에 의해 차단/SKIP된 IP 및 포트 목록 별도 기록 (리포트 또는 로그).

---

##### 🎨 디자인 원칙
- **간결하고 직관적인 UI/UX**:
  - 사용자가 최소한의 클릭(1~2번)으로 스캔 시작 및 결과 확인 가능.
- **전문적이고 신뢰감을 주는 디자인**:
  - 과도하지 않은 범위 내 Apple 스타일 참고 (깔끔한 레이아웃, 부드러운 색상).
- **테마 지원**:
  - 기본(오프화이트 계열) 및 다크 모드 지원 (QSS 스타일시트 활용).
- **시각적 피드백 강화**:
  - 진행률 바(QProgressBar), 상태별 색상 구분, 아이콘 활용 (PyQt 내장 아이콘 또는 qt-material, QFluentWidgets 활용).
- **애니메이션 최소화**:
  - 부드러운 전환 효과 (QPropertyAnimation 활용한 페이드 인/아웃) 정도만 고려, 성능 저하 방지.

---

##### 📦 설치 및 배포 환경
- **지원 OS**:
  - Windows 10/11 (64비트), Linux (주요 배포판, 예: Ubuntu LTS 64비트) 동시 지원.
- **배포 형태**:
  - 독립 실행형 파일(Standalone Executable).
  - PyInstaller 사용: Windows용 `.exe`, Linux용 실행 파일 생성.
- **Nmap 의존성 처리**:
  - **권장**: 사용자에게 Nmap 사전 설치 가이드 제공 (라이선스 및 패키지 크기 문제 회피).
  - **차선**: Nmap 실행 파일을 패키지에 포함 (배포 전 Nmap 라이선스 재확인 필요, GPL-2.0 준수).
- **USB 휴대형**:
  - 실행 파일, `config.ini` (기본값 포함), 결과 저장 폴더(`results`) 등을 포함하여 USB에 복사하여 사용 가능.
- **오프라인 작동**:
  - 라이선스 검증 및 핵심 스캔 기능은 인터넷 연결 없이 완벽히 작동.
  - 부가 기능(CVE DB 업데이트 등)은 초기 버전에서 제외.
- **권한**:
  - Nmap Raw Socket 사용 및 일부 스텔스 기능 위해 관리자 권한으로 실행 필요 (실행 시 권한 상승 요청).

---

##### 🧪 보안 및 운영 테스트 항목
- 라이선스 키 미입력/오입력 시 실행 제한 테스트.
- 라이선스 관련 파일 임의 삭제/수정 시 복구 및 재인증 요구 테스트.
- 스텔스 기능 작동 확인 (Task Manager에서 비정상적이지 않은지 확인).
- 주요 보안 솔루션(Windows Defender, AhnLab V3, CrowdStrike 등) 환경에서 스캔 실행 및 SKIP 로직 정상 작동 테스트.
- 다양한 네트워크 환경(대규모 C 클래스, 방화벽 존재 등)에서의 스캔 안정성 및 부하 테스트 (CPU, RAM, 네트워크 트래픽 측정).
- 스캔 중 강제 종료(프로세스 킬, PC 재부팅) 후 Resume 기능 정상 작동 테스트.
- 오류 발생 시 로그 기록 및 사용자 알림 정확성 테스트.

---

##### 🛠️ 개발 도구 및 환경
- **언어**: Python 3.10+.
- **GUI**: PyQt5 또는 PySide6.
- **핵심 로직**: Nmap CLI + `subprocess` 모듈.
- **파일 처리**: `openpyxl` (Excel), `pandas` (데이터 처리), `configparser` (설정).
- **패키징**: PyInstaller.
- **시각화 (선택적)**: PyQtChart.
- **코드 관리**: Git, GitHub/GitLab.
- **개발 환경**: VS Code + Python Extension + Cursor AI.

---

##### 🚦 개발 우선순위 (총 예상 8주)
- **[1주차]** 환경 설정, `config.ini` 파서, 라이선스 키 기본 구조 및 오프라인 검증 로직 구현.
- **[2-3주차]** Nmap 연동 (`subprocess`), 기본 체크리스트(호스트/포트/서비스/OS) 자동화 및 상태 추적 로직 구현.
- **[4주차]** 결과 파싱 및 Excel/로그 리포트 자동 생성 기능 구현.
- **[5주차]** 보안 솔루션 탐지 시 SKIP 처리 로직 및 관련 로그 기록 구현.
- **[6주차]** 기본 PyQt UI 구현 (설정 편집, 스캔 시작/중지, 결과 테이블 표시, Progress Bar, ETA).
- **[7주차]** 상태 저장 및 Resume 기능 구현, 오류 처리 강화.
- **[8주차]** 스텔스 기능 (최소화된 탐지 노력), 최종 테스트, 패키징 및 문서화.

---

##### 🏁 결론
수정된 PRD v1.3은 체크리스트 항목을 모두 반영하여 상업용 비인증 네트워크 스캐너 개발을 위한 완성도 높은 청사진을 제공합니다:
- **체크리스트 반영**: 호스트 탐색, 포트/서비스 스캔, OS 추정, 세부 점검(SMB, HTTP, HTTPS, FTP, Telnet, RDP, VNC, SNMP, DNS/mDNS, DHCP), 오프라인 분석(EOS, CVE, 취약 프로토콜, 배너 민감 정보) 모두 포함.
- **구체화**: Nmap 명령어(-PR, -PE, -Pn, -sV --version-intensity 2 등), NSE 스크립트 목록, 리포트 항목(MAC 주소, 정책 위반 여부 등) 명시.
- **초보자 친화적**: 설정 편집 UI, 간단한 배포, 오류 처리 강화.

이 PRD를 바탕으로 개발을 시작하면, 코딩 초보자도 Cursor AI를 활용해 성공적으로 프로젝트를 완료하고 상업화까지 나아갈 수 있을 것입니다. 추가 요청(예: 특정 기능 세부 구현, UI 디자인 초안)이 있으면 말씀해주세요! 😊